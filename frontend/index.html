<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PharmaGuard Dashboard</title>

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/style.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Google Translate -->
<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement(
      {
        pageLanguage: 'en',
        includedLanguages: 'en,hi,kn,ta,te',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      },
      'google_translate_element'
    );
  }
</script>

<script
  type="text/javascript"
  src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
</script>
</head>

<body>

<!-- ================= LOGIN SECTION ================= -->
<div id="loginSection" class="login-page">
  <div class="login-box">
    <h2>üîê PharmaGuard Login</h2>

    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />

    <button onclick="login()">Login</button>

    <p class="login-note">Demo Access Credentials</p>
    <div class="demo-creds">
      <p><strong>Email:</strong> demo@pharmaguard.ai</p>
      <p><strong>Password:</strong> pharmaguard123</p>
    </div>
  </div>
</div>

<!-- ================= DASHBOARD SECTION ================= -->
<div id="dashboardSection" style="display:none;">

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-left">üß¨ <span>PharmaGuard</span></div>
    <div class="nav-right">
      Precision Medicine Dashboard
      <button class="logout-btn" onclick="logout()">Logout</button>
      <div id="google_translate_element"></div>
    </div>
  </nav>

  <!-- MAIN DASHBOARD -->
  <div class="dashboard">

    <!-- ================= TOP INFO CARDS ================= -->
    <div class="info-cards">
      <div class="info-card">
        <h4>Drug Selected</h4>
        <p><span id="drugInfo">‚Äî</span></p>
      </div>
      <div class="info-card">
        <h4>Primary Gene</h4>
        <p><span id="geneInfo">‚Äî</span></p>
      </div>
      <div class="info-card">
        <h4>Risk Level</h4>
        <p><span id="riskInfo">‚Äî</span></p>
      </div>
      <div class="info-card">
        <h4>Risk Percentage</h4>
        <p><span id="confidenceInfo">‚Äî</span></p>
      </div>
    </div>

    <!-- ================= ANALYSIS PANEL ================= -->
    <div class="panel">
      <h2>Genetic Drug Risk Analysis</h2>

      <div class="form-grid">
        <div>
          <label>Upload VCF File</label>
          <input type="file" id="vcfFile" accept=".vcf" />
          <small class="file-hint">
            Supported: <strong>.vcf</strong> | Max size: <strong>5MB</strong>
          </small>
        </div>

        <div>
          <label>Select Drug</label>
          <select id="drug">
            <option value="CODEINE">CODEINE (CYP2D6)</option>
            <option value="WARFARIN">WARFARIN (CYP2C9)</option>
            <option value="CLOPIDOGREL">CLOPIDOGREL (CYP2C19)</option>
            <option value="SIMVASTATIN">SIMVASTATIN (SLCO1B1)</option>
            <option value="AZATHIOPRINE">AZATHIOPRINE (TPMT)</option>
            <option value="FLUOROURACIL">FLUOROURACIL (DPYD)</option>
          </select>
        </div>

        <div>
          <label>Language</label>
          <select id="language">
            <option value="en">English</option>
            <option value="hi">Hindi</option>
            <option value="kn">Kannada</option>
            <option value="ta">Tamil</option>
            <option value="te">Telugu</option>
          </select>
        </div>
      </div>

      <button onclick="analyze()">Run Analysis</button>
    </div>

    <!-- ================= RESULT PANEL ================= -->
    <div class="panel hidden" id="resultPanel">

      <h2>Risk Assessment</h2>

      <div id="riskBox" class="risk-box">
        <span id="riskLabel"></span>
        <span id="riskPercent"></span>
      </div>

      <!-- ================= CLINICAL RECOMMENDATION ================= -->
      <div class="panel-section">
        <h3>Clinical Recommendation</h3>
        <div id="recommendationBox" class="recommendation-box">
          <span id="recommendationText"></span>
        </div>
      </div>

      <!-- ================= SYMPTOMS & ACTIONS ================= -->
      <div class="panel-section" id="symptomsActionsSection" style="display:none;">
        <h3>Symptoms & Actions (If Already Taken!!)</h3>

        <div class="symptoms-box">
          <h4>‚ö†Ô∏è Possible Symptoms</h4>
          <ul id="symptomsList"></ul>

          <h4>üöë Recommended Actions</h4>
          <ul id="actionsList"></ul>
        </div>
      </div>
        <!-- ================= DRUG SENSITIVITY INDEX ================= -->
<div class="panel-section" id="sensitivitySection">
  <h3>üß™ Drug Sensitivity Index</h3>

  <div class="sensitivity-box">
    <div class="sensitivity-label">
      Genetic Sensitivity Score
    </div>

    <div class="sensitivity-bar">
      <div id="sensitivityFill"></div>
    </div>

    <p id="sensitivityText"></p>
  </div>
</div>
      <!-- ================= ALTERNATIVE DRUGS ================= -->
      <div class="panel-section" id="altDrugSection" style="display:none;">
        <h3>Alternative Drug & Dosage Recommendations</h3>

        <table class="alt-drug-table">
          <thead>
            <tr>
              <th>Drug</th>
              <th>Risk / Action</th>
              <th>Dosage Guidance</th>
            </tr>
          </thead>
          <tbody id="altDrugTableBody"></tbody>
        </table>

        <p class="disclaimer">
          ‚ö† Decision-support only. Final prescription must be made by a qualified clinician.
        </p>
      </div>

      <!-- ================= VISUALIZATION (FIXED) ================= -->
      <!-- ================= VISUALIZATION ================= -->
<div class="panel-section">
  <h3>Risk Visualization</h3>

  <div class="chart-container split">
    
    <!-- BAR CHART -->
    <div class="chart-box half">
      <h4 class="chart-title">Risk Percentage (Bar Chart)</h4>
      <canvas id="riskBarChart"></canvas>
    </div>

    <!-- PIE CHART -->
    <div class="chart-box half">
      <h4 class="chart-title">Risk Distribution (Pie Chart)</h4>
      <canvas id="riskPieChart"></canvas>
    </div>

  </div>
</div>

      <!-- ================= DETECTED GENES ================= -->
      <div class="panel-section">
        <h3>Detected Pharmacogenomic Genes</h3>
        <ul id="geneList" class="gene-list">
          <li id="gene-CYP2D6">CYP2D6</li>
          <li id="gene-CYP2C19">CYP2C19</li>
          <li id="gene-CYP2C9">CYP2C9</li>
          <li id="gene-SLCO1B1">SLCO1B1</li>
          <li id="gene-TPMT">TPMT</li>
          <li id="gene-DPYD">DPYD</li>
        </ul>
      </div>

      <!-- ================= EXPLANATION ================= -->
      <div class="panel-section">
        <h3>Explainable AI Summary</h3>
        <p id="explanation"></p>
      </div>

      <!-- ================= TRACE ================= -->
      <div class="panel-section">
        <h3>Decision Trace</h3>
        <ul id="trace"></ul>
      </div>

      <!-- ================= JSON ================= -->
      <div class="panel-section">
        <div class="json-header">
          <h3>üìã Structured JSON Report</h3>
          <button class="copy-btn" onclick="copyJSONReport()">üìé Copy</button>
        </div>
        <pre id="jsonOutput"></pre>
      </div>

      <!-- ================= CHATBOT ================= -->
      <div class="panel-section">
        <h3>24/7 AI Help Assistant</h3>
        <div class="chatbot-box">
          <div id="chatHistory"></div>
          <input type="text" id="chatMessage" placeholder="Ask about your result..." />
          <button onclick="sendChat()">Send</button>
        </div>
      </div>

      <!-- ================= DOWNLOAD ================= -->
      <div class="panel-section">
        <button class="download-btn" onclick="downloadReport()">
          üìÑ Download Report (JSON Format)
        </button>
      </div>

    </div>
  </div>
</div>

<!-- ================= JS FILES ================= -->
<script src="assets/js/auth.js"></script>
<script src="assets/js/chatbot.js"></script>
<script src="assets/js/analyze.js"></script>
<script src="assets/js/visualization.js"></script>

</body>
</html>
